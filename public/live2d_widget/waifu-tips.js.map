{"version":3,"file":"waifu-tips.js","sources":["../build/utils.js","../build/message.js","../build/logger.js","../build/model.js","../build/icons.js","../build/chat.js","../build/settings.js","../build/tools.js","../build/widget.js","../build/drag.js","../build/waifu-tips.js"],"sourcesContent":["function randomSelection(obj) {\n    return Array.isArray(obj) ? obj[Math.floor(Math.random() * obj.length)] : obj;\n}\nfunction randomOtherOption(total, excludeIndex) {\n    const idx = Math.floor(Math.random() * (total - 1));\n    return idx >= excludeIndex ? idx + 1 : idx;\n}\nfunction loadExternalResource(url, type) {\n    return new Promise((resolve, reject) => {\n        let tag;\n        if (type === 'css') {\n            tag = document.createElement('link');\n            tag.rel = 'stylesheet';\n            tag.href = url;\n        }\n        else if (type === 'js') {\n            tag = document.createElement('script');\n            tag.src = url;\n        }\n        if (tag) {\n            tag.onload = () => resolve(url);\n            tag.onerror = () => reject(url);\n            document.head.appendChild(tag);\n        }\n    });\n}\nexport { randomSelection, loadExternalResource, randomOtherOption };\n","import { randomSelection } from './utils.js';\nlet messageTimer = null;\nfunction showMessage(text, timeout, priority, override = true) {\n    let currentPriority = parseInt(sessionStorage.getItem('waifu-message-priority'), 10);\n    if (isNaN(currentPriority)) {\n        currentPriority = 0;\n    }\n    if (!text ||\n        (override && currentPriority > priority) ||\n        (!override && currentPriority >= priority))\n        return;\n    if (messageTimer) {\n        clearTimeout(messageTimer);\n        messageTimer = null;\n    }\n    text = randomSelection(text);\n    sessionStorage.setItem('waifu-message-priority', String(priority));\n    const tips = document.getElementById('waifu-tips');\n    tips.innerHTML = text;\n    tips.classList.add('waifu-tips-active');\n    messageTimer = setTimeout(() => {\n        sessionStorage.removeItem('waifu-message-priority');\n        tips.classList.remove('waifu-tips-active');\n    }, timeout);\n}\nfunction welcomeMessage(time, welcomeTemplate, referrerTemplate) {\n    if (location.pathname === '/') {\n        for (const { hour, text } of time) {\n            const now = new Date(), after = hour.split('-')[0], before = hour.split('-')[1] || after;\n            if (Number(after) <= now.getHours() && now.getHours() <= Number(before)) {\n                return text;\n            }\n        }\n    }\n    if (!welcomeTemplate)\n        return '';\n    const text = i18n(welcomeTemplate, document.title);\n    if (document.referrer === '' || !referrerTemplate)\n        return text;\n    const referrer = new URL(document.referrer);\n    if (location.hostname === referrer.hostname)\n        return text;\n    return `${i18n(referrerTemplate, referrer.hostname)}<br>${text}`;\n}\nfunction i18n(template, ...args) {\n    return template.replace(/\\$(\\d+)/g, (_, idx) => {\n        var _a;\n        const i = parseInt(idx, 10) - 1;\n        return (_a = args[i]) !== null && _a !== void 0 ? _a : '';\n    });\n}\nexport { showMessage, welcomeMessage, i18n };\n","class Logger {\n    constructor(level = 'info') {\n        this.level = level;\n    }\n    setLevel(level) {\n        if (!level)\n            return;\n        this.level = level;\n    }\n    shouldLog(level) {\n        return Logger.levelOrder[level] <= Logger.levelOrder[this.level];\n    }\n    error(message, ...args) {\n        if (this.shouldLog('error')) {\n            console.error('[Live2D Widget][ERROR]', message, ...args);\n        }\n    }\n    warn(message, ...args) {\n        if (this.shouldLog('warn')) {\n            console.warn('[Live2D Widget][WARN]', message, ...args);\n        }\n    }\n    info(message, ...args) {\n        if (this.shouldLog('info')) {\n            console.log('[Live2D Widget][INFO]', message, ...args);\n        }\n    }\n    trace(message, ...args) {\n        if (this.shouldLog('trace')) {\n            console.log('[Live2D Widget][TRACE]', message, ...args);\n        }\n    }\n}\nLogger.levelOrder = {\n    error: 0,\n    warn: 1,\n    info: 2,\n    trace: 3,\n};\nconst logger = new Logger();\nexport default logger;\n","import { showMessage } from './message.js';\nimport { loadExternalResource, randomOtherOption } from './utils.js';\nimport logger from './logger.js';\nclass ModelManager {\n    constructor(config, models = []) {\n        var _a;\n        this.modelList = null;\n        let { apiPath, cdnPath } = config;\n        const { cubism2Path, cubism5Path } = config;\n        let useCDN = false;\n        if (typeof cdnPath === 'string') {\n            if (!cdnPath.endsWith('/'))\n                cdnPath += '/';\n            useCDN = true;\n        }\n        else if (typeof apiPath === 'string') {\n            if (!apiPath.endsWith('/'))\n                apiPath += '/';\n            cdnPath = apiPath;\n            useCDN = true;\n            logger.warn('apiPath option is deprecated. Please use cdnPath instead.');\n        }\n        else if (!models.length) {\n            throw 'Invalid initWidget argument!';\n        }\n        let modelId = parseInt(localStorage.getItem('modelId'), 10);\n        let modelTexturesId = parseInt(localStorage.getItem('modelTexturesId'), 10);\n        if (isNaN(modelId) || isNaN(modelTexturesId)) {\n            modelTexturesId = 0;\n        }\n        if (isNaN(modelId)) {\n            modelId = (_a = config.modelId) !== null && _a !== void 0 ? _a : 0;\n        }\n        this.useCDN = useCDN;\n        this.cdnPath = cdnPath || '';\n        this.cubism2Path = cubism2Path || '';\n        this.cubism5Path = cubism5Path || '';\n        this._modelId = modelId;\n        this._modelTexturesId = modelTexturesId;\n        this.currentModelVersion = 0;\n        this.loading = false;\n        this.modelJSONCache = {};\n        this.models = models;\n    }\n    static async initCheck(config, models = []) {\n        const model = new ModelManager(config, models);\n        if (model.useCDN) {\n            const response = await fetch(`${model.cdnPath}model_list.json`);\n            model.modelList = await response.json();\n            if (model.modelId >= model.modelList.models.length) {\n                model.modelId = 0;\n            }\n            const modelName = model.modelList.models[model.modelId];\n            if (Array.isArray(modelName)) {\n                if (model.modelTexturesId >= modelName.length) {\n                    model.modelTexturesId = 0;\n                }\n            }\n            else {\n                const modelSettingPath = `${model.cdnPath}model/${modelName}/index.json`;\n                const modelSetting = await model.fetchWithCache(modelSettingPath);\n                const version = model.checkModelVersion(modelSetting);\n                if (version === 2) {\n                    const textureCache = await model.loadTextureCache(modelName);\n                    if (model.modelTexturesId >= textureCache.length) {\n                        model.modelTexturesId = 0;\n                    }\n                }\n            }\n        }\n        else {\n            if (model.modelId >= model.models.length) {\n                model.modelId = 0;\n            }\n            if (model.modelTexturesId >= model.models[model.modelId].paths.length) {\n                model.modelTexturesId = 0;\n            }\n        }\n        return model;\n    }\n    set modelId(modelId) {\n        this._modelId = modelId;\n        localStorage.setItem('modelId', modelId.toString());\n    }\n    get modelId() {\n        return this._modelId;\n    }\n    set modelTexturesId(modelTexturesId) {\n        this._modelTexturesId = modelTexturesId;\n        localStorage.setItem('modelTexturesId', modelTexturesId.toString());\n    }\n    get modelTexturesId() {\n        return this._modelTexturesId;\n    }\n    resetCanvas() {\n        document.getElementById('waifu-canvas').innerHTML = '<canvas id=\"live2d\" width=\"800\" height=\"800\"></canvas>';\n    }\n    async fetchWithCache(url) {\n        let result;\n        if (url in this.modelJSONCache) {\n            result = this.modelJSONCache[url];\n        }\n        else {\n            try {\n                const response = await fetch(url);\n                result = await response.json();\n            }\n            catch (_a) {\n                result = null;\n            }\n            this.modelJSONCache[url] = result;\n        }\n        return result;\n    }\n    checkModelVersion(modelSetting) {\n        if (modelSetting.Version === 3 || modelSetting.FileReferences) {\n            return 3;\n        }\n        return 2;\n    }\n    async loadLive2D(modelSettingPath, modelSetting) {\n        if (this.loading) {\n            logger.warn('Still loading. Abort.');\n            return;\n        }\n        this.loading = true;\n        try {\n            const version = this.checkModelVersion(modelSetting);\n            if (version === 2) {\n                if (!this.cubism2model) {\n                    if (!this.cubism2Path) {\n                        logger.error('No cubism2Path set, cannot load Cubism 2 Core.');\n                        return;\n                    }\n                    await loadExternalResource(this.cubism2Path, 'js');\n                    const { default: Cubism2Model } = await import('./cubism2/index.js');\n                    this.cubism2model = new Cubism2Model();\n                }\n                if (this.currentModelVersion === 3) {\n                    this.cubism5model.release();\n                    this.resetCanvas();\n                }\n                if (this.currentModelVersion === 3 || !this.cubism2model.gl) {\n                    await this.cubism2model.init('live2d', modelSettingPath, modelSetting);\n                }\n                else {\n                    await this.cubism2model.changeModelWithJSON(modelSettingPath, modelSetting);\n                }\n            }\n            else {\n                if (!this.cubism5Path) {\n                    logger.error('No cubism5Path set, cannot load Cubism 5 Core.');\n                    return;\n                }\n                await loadExternalResource(this.cubism5Path, 'js');\n                const { AppDelegate: Cubism5Model } = await import('./cubism5/index.js');\n                this.cubism5model = new Cubism5Model();\n                if (this.currentModelVersion === 2) {\n                    this.cubism2model.destroy();\n                    this.resetCanvas();\n                }\n                if (this.currentModelVersion === 2 || !this.cubism5model.subdelegates.at(0)) {\n                    this.cubism5model.initialize();\n                    this.cubism5model.changeModel(modelSettingPath);\n                    this.cubism5model.run();\n                }\n                else {\n                    this.cubism5model.changeModel(modelSettingPath);\n                }\n            }\n            logger.info(`Model ${modelSettingPath} (Cubism version ${version}) loaded`);\n            this.currentModelVersion = version;\n        }\n        catch (err) {\n            console.error('loadLive2D failed', err);\n        }\n        this.loading = false;\n    }\n    async loadTextureCache(modelName) {\n        const textureCache = await this.fetchWithCache(`${this.cdnPath}model/${modelName}/textures.cache`);\n        return textureCache || [];\n    }\n    async loadModel(message) {\n        let modelSettingPath, modelSetting;\n        if (this.useCDN) {\n            let modelName = this.modelList.models[this.modelId];\n            if (Array.isArray(modelName)) {\n                modelName = modelName[this.modelTexturesId];\n            }\n            modelSettingPath = `${this.cdnPath}model/${modelName}/index.json`;\n            modelSetting = await this.fetchWithCache(modelSettingPath);\n            const version = this.checkModelVersion(modelSetting);\n            if (version === 2) {\n                const textureCache = await this.loadTextureCache(modelName);\n                if (textureCache.length > 0) {\n                    let textures = textureCache[this.modelTexturesId];\n                    if (typeof textures === 'string')\n                        textures = [textures];\n                    modelSetting.textures = textures;\n                }\n            }\n        }\n        else {\n            modelSettingPath = this.models[this.modelId].paths[this.modelTexturesId];\n            modelSetting = await this.fetchWithCache(modelSettingPath);\n        }\n        await this.loadLive2D(modelSettingPath, modelSetting);\n        showMessage(message, 4000, 10);\n    }\n    async loadRandTexture(successMessage = '', failMessage = '') {\n        const { modelId } = this;\n        let noTextureAvailable = false;\n        if (this.useCDN) {\n            const modelName = this.modelList.models[modelId];\n            if (Array.isArray(modelName)) {\n                this.modelTexturesId = randomOtherOption(modelName.length, this.modelTexturesId);\n            }\n            else {\n                const modelSettingPath = `${this.cdnPath}model/${modelName}/index.json`;\n                const modelSetting = await this.fetchWithCache(modelSettingPath);\n                const version = this.checkModelVersion(modelSetting);\n                if (version === 2) {\n                    const textureCache = await this.loadTextureCache(modelName);\n                    if (textureCache.length <= 1) {\n                        noTextureAvailable = true;\n                    }\n                    else {\n                        this.modelTexturesId = randomOtherOption(textureCache.length, this.modelTexturesId);\n                    }\n                }\n                else {\n                    noTextureAvailable = true;\n                }\n            }\n        }\n        else {\n            if (this.models[modelId].paths.length === 1) {\n                noTextureAvailable = true;\n            }\n            else {\n                this.modelTexturesId = randomOtherOption(this.models[modelId].paths.length, this.modelTexturesId);\n            }\n        }\n        if (noTextureAvailable) {\n            showMessage(failMessage, 4000, 10);\n        }\n        else {\n            await this.loadModel(successMessage);\n        }\n    }\n    async loadNextModel() {\n        this.modelTexturesId = 0;\n        if (this.useCDN) {\n            this.modelId = (this.modelId + 1) % this.modelList.models.length;\n            await this.loadModel(this.modelList.messages[this.modelId]);\n        }\n        else {\n            this.modelId = (this.modelId + 1) % this.models.length;\n            await this.loadModel(this.models[this.modelId].message);\n        }\n    }\n}\nexport { ModelManager };\n","const fa_comment = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4c0 0 0 0 0 0s0 0 0 0s0 0 0 0c0 0 0 0 0 0l.3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z\"/></svg>';\nconst fa_paper_plane = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480l0-83.6c0-4 1.5-7.8 4.2-10.8L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z\"/></svg>';\nconst fa_street_view = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M320 64A64 64 0 1 0 192 64a64 64 0 1 0 128 0zm-96 96c-35.3 0-64 28.7-64 64l0 48c0 17.7 14.3 32 32 32l1.8 0 11.1 99.5c1.8 16.2 15.5 28.5 31.8 28.5l38.7 0c16.3 0 30-12.3 31.8-28.5L318.2 304l1.8 0c17.7 0 32-14.3 32-32l0-48c0-35.3-28.7-64-64-64l-64 0zM132.3 394.2c13-2.4 21.7-14.9 19.3-27.9s-14.9-21.7-27.9-19.3c-32.4 5.9-60.9 14.2-82 24.8c-10.5 5.3-20.3 11.7-27.8 19.6C6.4 399.5 0 410.5 0 424c0 21.4 15.5 36.1 29.1 45c14.7 9.6 34.3 17.3 56.4 23.4C130.2 504.7 190.4 512 256 512s125.8-7.3 170.4-19.6c22.1-6.1 41.8-13.8 56.4-23.4c13.7-8.9 29.1-23.6 29.1-45c0-13.5-6.4-24.5-14-32.6c-7.5-7.9-17.3-14.3-27.8-19.6c-21-10.6-49.5-18.9-82-24.8c-13-2.4-25.5 6.3-27.9 19.3s6.3 25.5 19.3 27.9c30.2 5.5 53.7 12.8 69 20.5c3.2 1.6 5.8 3.1 7.9 4.5c3.6 2.4 3.6 7.2 0 9.6c-8.8 5.7-23.1 11.8-43 17.3C374.3 457 318.5 464 256 464s-118.3-7-157.7-17.9c-19.9-5.5-34.2-11.6-43-17.3c-3.6-2.4-3.6-7.2 0-9.6c2.1-1.4 4.8-2.9 7.9-4.5c15.3-7.7 38.8-14.9 69-20.5z\"/></svg>';\nconst fa_shirt = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M211.8 0c7.8 0 14.3 5.7 16.7 13.2C240.8 51.9 277.1 80 320 80s79.2-28.1 91.5-66.8C413.9 5.7 420.4 0 428.2 0l12.6 0c22.5 0 44.2 7.9 61.5 22.3L628.5 127.4c6.6 5.5 10.7 13.5 11.4 22.1s-2.1 17.1-7.8 23.6l-56 64c-11.4 13.1-31.2 14.6-44.6 3.5L480 197.7 480 448c0 35.3-28.7 64-64 64l-192 0c-35.3 0-64-28.7-64-64l0-250.3-51.5 42.9c-13.3 11.1-33.1 9.6-44.6-3.5l-56-64c-5.7-6.5-8.5-15-7.8-23.6s4.8-16.6 11.4-22.1L137.7 22.3C155 7.9 176.7 0 199.2 0l12.6 0z\"/></svg>';\nconst fa_camera_retro = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M220.6 121.2L271.1 96 448 96l0 96-114.8 0c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24L64 192l0-64 128 0c9.9 0 19.7-2.3 28.6-6.8zM0 128L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L271.1 32c-9.9 0-19.7 2.3-28.6 6.8L192 64l-32 0 0-16c0-8.8-7.2-16-16-16L80 32c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM168 304a88 88 0 1 1 176 0 88 88 0 1 1 -176 0z\"/></svg>';\nconst fa_info_circle = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z\"/></svg>';\nconst fa_xmark = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"/></svg>';\nconst fa_child = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M96 64a64 64 0 1 1 128 0A64 64 0 1 1 96 64zm48 320l0 96c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-192.2L59.1 321c-9.4 15-29.2 19.4-44.1 10S-4.5 301.9 4.9 287l39.9-63.3C69.7 184 113.2 160 160 160s90.3 24 115.2 63.6L315.1 287c9.4 15 4.9 34.7-10 44.1s-34.7 4.9-44.1-10L240 287.8 240 480c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-96-32 0z\"/></svg>';\nexport { fa_comment, fa_paper_plane, fa_street_view, fa_shirt, fa_camera_retro, fa_info_circle, fa_xmark, fa_child };\n","class ChatUI {\n    constructor(endpoint = '/api/live2d-chat', tipsEl) {\n        this.container = null;\n        this.listEl = null;\n        this.inputEl = null;\n        this.sendBtn = null;\n        this.messages = [\n            {\n                id: 'init',\n                role: 'assistant',\n                content: 'æˆ‘æ˜¯é©»åœºçœ‹æ¿å¨˜ï¼Œæœ‰å•¥æƒ³é—®çš„å°±è¯´ï½ž',\n            },\n        ];\n        this.loading = false;\n        this.tipsEl = null;\n        this.visible = false;\n        this.endpoint = endpoint;\n        if (tipsEl)\n            this.tipsEl = tipsEl;\n    }\n    setTipsElement(el) {\n        this.tipsEl = el;\n    }\n    init() {\n        if (this.container)\n            return;\n        const container = document.createElement('div');\n        container.id = 'waifu-chat';\n        Object.assign(container.style, {\n            position: 'fixed',\n            bottom: '220px',\n            right: '35px',\n            width: '320px',\n            background: 'rgba(255,255,255,.92)',\n            boxShadow: '0 12px 30px rgba(0,0,0,.25)',\n            borderRadius: '16px',\n            overflow: 'hidden',\n            display: 'none',\n            flexDirection: 'column',\n            gap: '0',\n            zIndex: '1000',\n        });\n        const title = document.createElement('div');\n        Object.assign(title.style, {\n            padding: '10px 12px',\n            fontWeight: '600',\n            borderBottom: '1px solid rgba(0,0,0,.06)',\n        });\n        title.textContent = 'çœ‹æ¿å¨˜';\n        container.appendChild(title);\n        const list = document.createElement('div');\n        Object.assign(list.style, {\n            maxHeight: '240px',\n            overflowY: 'auto',\n            padding: '8px 12px',\n            display: 'flex',\n            flexDirection: 'column',\n            gap: '6px',\n        });\n        container.appendChild(list);\n        this.listEl = list;\n        const bottom = document.createElement('div');\n        Object.assign(bottom.style, {\n            display: 'flex',\n            gap: '6px',\n            padding: '8px',\n            borderTop: '1px solid rgba(0,0,0,.06)',\n        });\n        const input = document.createElement('input');\n        input.placeholder = 'å’Œçœ‹æ¿å¨˜è¯´ç‚¹å•¥â€¦';\n        Object.assign(input.style, {\n            flex: '1',\n            border: '1px solid rgba(0,0,0,.1)',\n            borderRadius: '8px',\n            padding: '6px 8px',\n            fontSize: '13px',\n        });\n        input.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter')\n                this.handleSend();\n        });\n        const btn = document.createElement('button');\n        btn.textContent = 'å‘é€';\n        Object.assign(btn.style, {\n            background: '#4c6ef5',\n            color: '#fff',\n            border: 'none',\n            borderRadius: '8px',\n            padding: '0 14px',\n            cursor: 'pointer',\n            fontSize: '13px',\n            whiteSpace: 'nowrap',\n        });\n        btn.addEventListener('click', () => this.handleSend());\n        bottom.appendChild(input);\n        bottom.appendChild(btn);\n        container.appendChild(bottom);\n        this.inputEl = input;\n        this.sendBtn = btn;\n        this.container = container;\n        container.addEventListener('mouseleave', () => this.hide());\n        document.body.appendChild(container);\n        this.refresh();\n    }\n    refresh() {\n        if (!this.listEl)\n            return;\n        this.listEl.innerHTML = '';\n        for (const m of this.messages) {\n            const bubble = document.createElement('div');\n            const isUser = m.role === 'user';\n            Object.assign(bubble.style, {\n                alignSelf: isUser ? 'flex-end' : 'flex-start',\n                background: isUser ? 'rgba(76,110,245,.9)' : '#f2f2f2',\n                color: isUser ? '#fff' : '#222',\n                padding: '6px 10px',\n                borderRadius: isUser ? '14px 0 14px 14px' : '0 14px 14px 14px',\n                maxWidth: '80%',\n                wordBreak: 'break-word',\n                fontSize: '13px',\n            });\n            bubble.textContent = m.content;\n            this.listEl.appendChild(bubble);\n        }\n        this.listEl.scrollTop = this.listEl.scrollHeight;\n    }\n    show() {\n        this.init();\n        this.visible = true;\n        if (this.container)\n            this.container.style.display = 'flex';\n    }\n    hide() {\n        this.visible = false;\n        if (this.container)\n            this.container.style.display = 'none';\n    }\n    toggle() {\n        if (this.visible)\n            this.hide();\n        else\n            this.show();\n    }\n    addMessage(role, content) {\n        this.messages.push({ id: Date.now() + (role === 'user' ? '-u' : '-a'), role, content });\n        this.refresh();\n    }\n    setLoading(loading) {\n        this.loading = loading;\n        if (this.sendBtn) {\n            this.sendBtn.disabled = loading;\n            this.sendBtn.textContent = loading ? '...' : 'å‘é€';\n            this.sendBtn.style.background = loading ? '#aaa' : '#4c6ef5';\n            this.sendBtn.style.cursor = loading ? 'not-allowed' : 'pointer';\n        }\n    }\n    async handleSend() {\n        var _a, _b, _c;\n        if (!this.inputEl)\n            return;\n        const text = this.inputEl.value.trim();\n        if (!text || this.loading)\n            return;\n        this.addMessage('user', text);\n        this.inputEl.value = '';\n        this.setLoading(true);\n        try {\n            const chatApiKey = localStorage.getItem('live2d.chat.key') || undefined;\n            const embedApiKey = localStorage.getItem('live2d.embed.key') || undefined;\n            const r = await fetch(this.endpoint, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ input: text, history: this.messages, keys: { chatApiKey, embedApiKey } }),\n            });\n            if (!r.ok)\n                throw new Error('HTTP ' + r.status);\n            const json = await r.json();\n            const content = ((_c = (_b = (_a = json === null || json === void 0 ? void 0 : json.data) === null || _a === void 0 ? void 0 : _a.content) !== null && _b !== void 0 ? _b : json === null || json === void 0 ? void 0 : json.data) !== null && _c !== void 0 ? _c : 'æˆ‘åœ¨ï¼Œä½†æ˜¯æˆ‘è¯´ä¸å‡ºè¯äº†ðŸ¤ï¼ˆåŽç«¯æ²¡è¿”å›ž contentï¼‰');\n            this.addMessage('assistant', content);\n            if (this.tipsEl)\n                this.tipsEl.textContent = content;\n        }\n        catch (err) {\n            console.error(err);\n            this.addMessage('assistant', 'æ¨¡åž‹æ²¡å›žæˆ‘ï¼Œå¯èƒ½æ˜¯ key æˆ–ç½‘ç»œæœ‰é—®é¢˜ã€‚');\n        }\n        finally {\n            this.setLoading(false);\n        }\n    }\n}\nlet __chatUI = null;\nexport function ensureChatUI(endpoint) {\n    if (!__chatUI) {\n        const tipsEl = document.getElementById('waifu-tips');\n        __chatUI = new ChatUI(endpoint || '/api/live2d-chat', tipsEl || undefined);\n        __chatUI.init();\n    }\n    return __chatUI;\n}\nexport { ChatUI };\n","const CHAT_KEY_STORAGE = 'live2d.chat.key';\nconst EMBED_KEY_STORAGE = 'live2d.embed.key';\nclass SettingsUI {\n    constructor() {\n        this.container = null;\n        this.chatInput = null;\n        this.embedInput = null;\n        this.visible = false;\n    }\n    init() {\n        if (this.container)\n            return;\n        const wrap = document.createElement('div');\n        wrap.id = 'waifu-settings';\n        Object.assign(wrap.style, {\n            position: 'fixed',\n            bottom: '220px',\n            right: '370px',\n            width: '340px',\n            background: 'rgba(255,255,255,.96)',\n            boxShadow: '0 12px 30px rgba(0,0,0,.25)',\n            borderRadius: '16px',\n            overflow: 'hidden',\n            display: 'none',\n            flexDirection: 'column',\n            zIndex: '1000',\n        });\n        const title = document.createElement('div');\n        Object.assign(title.style, {\n            padding: '10px 12px',\n            fontWeight: '600',\n            borderBottom: '1px solid rgba(0,0,0,.06)',\n        });\n        title.textContent = 'è®¾ç½® API Key';\n        wrap.appendChild(title);\n        const form = document.createElement('div');\n        Object.assign(form.style, {\n            display: 'flex',\n            flexDirection: 'column',\n            gap: '10px',\n            padding: '12px',\n        });\n        const chatLabel = document.createElement('label');\n        chatLabel.textContent = 'èŠå¤©æ¨¡åž‹ API Key';\n        const chatInput = document.createElement('input');\n        Object.assign(chatInput.style, {\n            border: '1px solid rgba(0,0,0,.1)',\n            borderRadius: '8px',\n            padding: '6px 8px',\n            fontSize: '13px',\n        });\n        const embedLabel = document.createElement('label');\n        embedLabel.textContent = 'åµŒå…¥æ¨¡åž‹ API Key';\n        const embedInput = document.createElement('input');\n        Object.assign(embedInput.style, {\n            border: '1px solid rgba(0,0,0,.1)',\n            borderRadius: '8px',\n            padding: '6px 8px',\n            fontSize: '13px',\n        });\n        const actions = document.createElement('div');\n        Object.assign(actions.style, {\n            display: 'flex',\n            gap: '8px',\n            paddingTop: '8px',\n            borderTop: '1px solid rgba(0,0,0,.06)',\n        });\n        const saveBtn = document.createElement('button');\n        saveBtn.textContent = 'ä¿å­˜';\n        Object.assign(saveBtn.style, {\n            background: '#4c6ef5',\n            color: '#fff',\n            border: 'none',\n            borderRadius: '8px',\n            padding: '6px 12px',\n            cursor: 'pointer',\n            fontSize: '13px',\n        });\n        saveBtn.addEventListener('click', () => this.save());\n        const clearBtn = document.createElement('button');\n        clearBtn.textContent = 'æ¸…é™¤';\n        Object.assign(clearBtn.style, {\n            background: '#aaa',\n            color: '#fff',\n            border: 'none',\n            borderRadius: '8px',\n            padding: '6px 12px',\n            cursor: 'pointer',\n            fontSize: '13px',\n        });\n        clearBtn.addEventListener('click', () => this.clear());\n        actions.appendChild(saveBtn);\n        actions.appendChild(clearBtn);\n        form.appendChild(chatLabel);\n        form.appendChild(chatInput);\n        form.appendChild(embedLabel);\n        form.appendChild(embedInput);\n        form.appendChild(actions);\n        wrap.appendChild(form);\n        this.container = wrap;\n        this.chatInput = chatInput;\n        this.embedInput = embedInput;\n        document.body.appendChild(wrap);\n        this.load();\n        wrap.addEventListener('mouseleave', () => this.hide());\n    }\n    load() {\n        if (!this.chatInput || !this.embedInput)\n            return;\n        this.chatInput.value = localStorage.getItem(CHAT_KEY_STORAGE) || '';\n        this.embedInput.value = localStorage.getItem(EMBED_KEY_STORAGE) || '';\n    }\n    save() {\n        if (!this.chatInput || !this.embedInput)\n            return;\n        localStorage.setItem(CHAT_KEY_STORAGE, this.chatInput.value.trim());\n        localStorage.setItem(EMBED_KEY_STORAGE, this.embedInput.value.trim());\n        this.hide();\n    }\n    clear() {\n        localStorage.removeItem(CHAT_KEY_STORAGE);\n        localStorage.removeItem(EMBED_KEY_STORAGE);\n        this.load();\n    }\n    show() {\n        this.init();\n        this.visible = true;\n        if (this.container)\n            this.container.style.display = 'flex';\n    }\n    hide() {\n        this.visible = false;\n        if (this.container)\n            this.container.style.display = 'none';\n    }\n    toggle() {\n        if (this.visible)\n            this.hide();\n        else\n            this.show();\n    }\n}\nlet __settingsUI = null;\nexport function ensureSettingsUI() {\n    if (!__settingsUI) {\n        __settingsUI = new SettingsUI();\n        __settingsUI.init();\n    }\n    return __settingsUI;\n}\nexport function getKeys() {\n    return {\n        chatApiKey: localStorage.getItem(CHAT_KEY_STORAGE) || undefined,\n        embedApiKey: localStorage.getItem(EMBED_KEY_STORAGE) || undefined,\n    };\n}\n","import { fa_comment, fa_paper_plane, fa_street_view, fa_shirt, fa_camera_retro, fa_info_circle, fa_xmark, } from './icons.js';\nimport { showMessage, i18n } from './message.js';\nimport { ensureChatUI } from './chat.js';\nimport { ensureSettingsUI } from './settings.js';\nclass ToolsManager {\n    constructor(model, config, tips) {\n        this.config = config;\n        this.tools = {\n            chat: {\n                icon: fa_comment,\n                callback: () => {\n                    const ui = ensureChatUI(this.config.chatEndpoint);\n                    ui.toggle();\n                },\n            },\n            settings: {\n                icon: fa_info_circle,\n                callback: () => {\n                    const ui = ensureSettingsUI();\n                    ui.toggle();\n                },\n            },\n            hitokoto: {\n                icon: fa_comment,\n                callback: async () => {\n                    const response = await fetch('https://v1.hitokoto.cn');\n                    const result = await response.json();\n                    const template = tips.message.hitokoto;\n                    const text = i18n(template, result.from, result.creator);\n                    showMessage(text, 6000, 9);\n                    setTimeout(() => {\n                        showMessage(text, 4000, 9);\n                    }, 6000);\n                },\n            },\n            asteroids: {\n                icon: fa_paper_plane,\n                callback: () => {\n                    if (window.Asteroids) {\n                        if (!window.ASTEROIDSPLAYERS)\n                            window.ASTEROIDSPLAYERS = [];\n                        window.ASTEROIDSPLAYERS.push(new window.Asteroids());\n                    }\n                    else {\n                        const script = document.createElement('script');\n                        script.src =\n                            'https://fastly.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js';\n                        document.head.appendChild(script);\n                    }\n                },\n            },\n            'switch-model': {\n                icon: fa_street_view,\n                callback: () => model.loadNextModel(),\n            },\n            'switch-texture': {\n                icon: fa_shirt,\n                callback: () => {\n                    let successMessage = '', failMessage = '';\n                    if (tips) {\n                        successMessage = tips.message.changeSuccess;\n                        failMessage = tips.message.changeFail;\n                    }\n                    model.loadRandTexture(successMessage, failMessage);\n                },\n            },\n            photo: {\n                icon: fa_camera_retro,\n                callback: () => {\n                    const message = tips.message.photo;\n                    showMessage(message, 6000, 9);\n                    const canvas = document.getElementById('live2d');\n                    if (!canvas)\n                        return;\n                    const imageUrl = canvas.toDataURL();\n                    const link = document.createElement('a');\n                    link.style.display = 'none';\n                    link.href = imageUrl;\n                    link.download = 'live2d-photo.png';\n                    document.body.appendChild(link);\n                    link.click();\n                    document.body.removeChild(link);\n                },\n            },\n            info: {\n                icon: fa_info_circle,\n                callback: () => {\n                    open('https://github.com/stevenjoezhang/live2d-widget');\n                },\n            },\n            quit: {\n                icon: fa_xmark,\n                callback: () => {\n                    localStorage.setItem('waifu-display', Date.now().toString());\n                    const message = tips.message.goodbye;\n                    showMessage(message, 2000, 11);\n                    const waifu = document.getElementById('waifu');\n                    if (!waifu)\n                        return;\n                    waifu.classList.remove('waifu-active');\n                    setTimeout(() => {\n                        waifu.classList.add('waifu-hidden');\n                        const waifuToggle = document.getElementById('waifu-toggle');\n                        waifuToggle === null || waifuToggle === void 0 ? void 0 : waifuToggle.classList.add('waifu-toggle-active');\n                    }, 3000);\n                },\n            },\n        };\n    }\n    registerTools() {\n        var _a;\n        if (!Array.isArray(this.config.tools)) {\n            this.config.tools = Object.keys(this.tools);\n        }\n        for (const toolName of this.config.tools) {\n            if (this.tools[toolName]) {\n                const { icon, callback } = this.tools[toolName];\n                const element = document.createElement('span');\n                element.id = `waifu-tool-${toolName}`;\n                element.innerHTML = icon;\n                (_a = document\n                    .getElementById('waifu-tool')) === null || _a === void 0 ? void 0 : _a.insertAdjacentElement('beforeend', element);\n                element.addEventListener('click', callback);\n            }\n        }\n    }\n}\nexport { ToolsManager };\n","import { ModelManager } from './model.js';\nimport { showMessage, welcomeMessage } from './message.js';\nimport { ToolsManager } from './tools.js';\nimport logger from './logger.js';\nimport registerDrag from './drag.js';\nimport { fa_child } from './icons.js';\nimport { randomSelection } from './utils.js';\nfunction registerEventListener(tips) {\n    let userAction = false;\n    let userActionTimer;\n    const messageArray = tips.message.default;\n    tips.seasons.forEach(({ date, text }) => {\n        const now = new Date(), after = date.split('-')[0], before = date.split('-')[1] || after;\n        if (Number(after.split('/')[0]) <= now.getMonth() + 1 &&\n            now.getMonth() + 1 <= Number(before.split('/')[0]) &&\n            Number(after.split('/')[1]) <= now.getDate() &&\n            now.getDate() <= Number(before.split('/')[1])) {\n            text = randomSelection(text);\n            text = text.replace('{year}', String(now.getFullYear()));\n            messageArray.push(text);\n        }\n    });\n    let lastHoverElement;\n    window.addEventListener('mousemove', () => (userAction = true));\n    window.addEventListener('keydown', () => (userAction = true));\n    setInterval(() => {\n        if (userAction) {\n            userAction = false;\n            clearInterval(userActionTimer);\n            userActionTimer = null;\n        }\n        else if (!userActionTimer) {\n            userActionTimer = setInterval(() => {\n                showMessage(messageArray, 6000, 9);\n            }, 20000);\n        }\n    }, 1000);\n    window.addEventListener('mouseover', (event) => {\n        var _a;\n        for (let { selector, text } of tips.mouseover) {\n            if (!((_a = event.target) === null || _a === void 0 ? void 0 : _a.closest(selector)))\n                continue;\n            if (lastHoverElement === selector)\n                return;\n            lastHoverElement = selector;\n            text = randomSelection(text);\n            text = text.replace('{text}', event.target.innerText);\n            showMessage(text, 4000, 8);\n            return;\n        }\n    });\n    window.addEventListener('click', (event) => {\n        var _a;\n        for (let { selector, text } of tips.click) {\n            if (!((_a = event.target) === null || _a === void 0 ? void 0 : _a.closest(selector)))\n                continue;\n            text = randomSelection(text);\n            text = text.replace('{text}', event.target.innerText);\n            showMessage(text, 4000, 8);\n            return;\n        }\n    });\n    window.addEventListener('live2d:hoverbody', () => {\n        const text = randomSelection(tips.message.hoverBody);\n        showMessage(text, 4000, 8, false);\n    });\n    window.addEventListener('live2d:tapbody', () => {\n        const text = randomSelection(tips.message.tapBody);\n        showMessage(text, 4000, 9);\n    });\n    const devtools = () => { };\n    console.log('%c', devtools);\n    devtools.toString = () => {\n        showMessage(tips.message.console, 6000, 9);\n    };\n    window.addEventListener('copy', () => {\n        showMessage(tips.message.copy, 6000, 9);\n    });\n    window.addEventListener('visibilitychange', () => {\n        if (!document.hidden)\n            showMessage(tips.message.visibilitychange, 6000, 9);\n    });\n}\nasync function loadWidget(config) {\n    var _a;\n    localStorage.removeItem('waifu-display');\n    sessionStorage.removeItem('waifu-message-priority');\n    document.body.insertAdjacentHTML('beforeend', `<div id=\"waifu\">\r\n       <div id=\"waifu-tips\"></div>\r\n       <div id=\"waifu-canvas\">\r\n         <canvas id=\"live2d\" width=\"800\" height=\"800\"></canvas>\r\n       </div>\r\n       <div id=\"waifu-tool\"></div>\r\n     </div>`);\n    let models = [];\n    let tips;\n    if (config.waifuPath) {\n        const response = await fetch(config.waifuPath);\n        tips = await response.json();\n        models = tips.models;\n        registerEventListener(tips);\n        showMessage(welcomeMessage(tips.time, tips.message.welcome, tips.message.referrer), 7000, 11);\n    }\n    const model = await ModelManager.initCheck(config, models);\n    await model.loadModel('');\n    new ToolsManager(model, config, tips).registerTools();\n    if (config.drag)\n        registerDrag();\n    (_a = document.getElementById('waifu')) === null || _a === void 0 ? void 0 : _a.classList.add('waifu-active');\n}\nfunction initWidget(config) {\n    if (typeof config === 'string') {\n        logger.error('Your config for Live2D initWidget is outdated. Please refer to https://github.com/stevenjoezhang/live2d-widget/blob/master/dist/autoload.js');\n        return;\n    }\n    logger.setLevel(config.logLevel);\n    document.body.insertAdjacentHTML('beforeend', `<div id=\"waifu-toggle\">\r\n       ${fa_child}\r\n     </div>`);\n    const toggle = document.getElementById('waifu-toggle');\n    toggle === null || toggle === void 0 ? void 0 : toggle.addEventListener('click', () => {\n        var _a;\n        toggle === null || toggle === void 0 ? void 0 : toggle.classList.remove('waifu-toggle-active');\n        if (toggle === null || toggle === void 0 ? void 0 : toggle.getAttribute('first-time')) {\n            loadWidget(config);\n            toggle === null || toggle === void 0 ? void 0 : toggle.removeAttribute('first-time');\n        }\n        else {\n            localStorage.removeItem('waifu-display');\n            (_a = document.getElementById('waifu')) === null || _a === void 0 ? void 0 : _a.classList.remove('waifu-hidden');\n            setTimeout(() => {\n                var _a;\n                (_a = document.getElementById('waifu')) === null || _a === void 0 ? void 0 : _a.classList.add('waifu-active');\n            }, 0);\n        }\n    });\n    if (localStorage.getItem('waifu-display') &&\n        Date.now() - Number(localStorage.getItem('waifu-display')) <= 86400000) {\n        toggle === null || toggle === void 0 ? void 0 : toggle.setAttribute('first-time', 'true');\n        setTimeout(() => {\n            toggle === null || toggle === void 0 ? void 0 : toggle.classList.add('waifu-toggle-active');\n        }, 0);\n    }\n    else {\n        loadWidget(config);\n    }\n}\nexport { initWidget };\n","function registerDrag() {\n    const element = document.getElementById('waifu');\n    if (!element)\n        return;\n    let winWidth = window.innerWidth, winHeight = window.innerHeight;\n    const imgWidth = element.offsetWidth, imgHeight = element.offsetHeight;\n    element.addEventListener('mousedown', event => {\n        if (event.button === 2) {\n            return;\n        }\n        const canvas = document.getElementById('live2d');\n        if (event.target !== canvas)\n            return;\n        event.preventDefault();\n        const _offsetX = event.offsetX, _offsetY = event.offsetY;\n        document.onmousemove = event => {\n            const _x = event.clientX, _y = event.clientY;\n            let _left = _x - _offsetX, _top = _y - _offsetY;\n            if (_top < 0) {\n                _top = 0;\n            }\n            else if (_top >= winHeight - imgHeight) {\n                _top = winHeight - imgHeight;\n            }\n            if (_left < 0) {\n                _left = 0;\n            }\n            else if (_left >= winWidth - imgWidth) {\n                _left = winWidth - imgWidth;\n            }\n            element.style.top = _top + 'px';\n            element.style.left = _left + 'px';\n        };\n        document.onmouseup = () => {\n            document.onmousemove = null;\n        };\n    });\n    window.onresize = () => {\n        winWidth = window.innerWidth;\n        winHeight = window.innerHeight;\n    };\n}\nexport default registerDrag;\n","import { initWidget } from './widget.js';\nwindow.initWidget = initWidget;\n"],"names":["randomSelection","obj","Array","isArray","Math","floor","random","length","randomOtherOption","total","excludeIndex","idx","loadExternalResource","url","type","Promise","resolve","reject","tag","document","createElement","src","onload","onerror","head","appendChild","messageTimer","showMessage","text","timeout","priority","override","currentPriority","parseInt","sessionStorage","getItem","isNaN","clearTimeout","setItem","String","tips","getElementById","innerHTML","classList","add","setTimeout","removeItem","remove","i18n","template","args","replace","_","_a","i","Logger","constructor","level","this","setLevel","shouldLog","levelOrder","error","message","console","warn","info","log","trace","logger","ModelManager","config","models","modelList","apiPath","cdnPath","cubism2Path","cubism5Path","useCDN","endsWith","modelId","localStorage","modelTexturesId","_modelId","_modelTexturesId","currentModelVersion","loading","modelJSONCache","initCheck","model","response","fetch","json","modelName","modelSettingPath","modelSetting","fetchWithCache","checkModelVersion","textureCache","loadTextureCache","paths","toString","resetCanvas","result","Version","FileReferences","loadLive2D","version","cubism2model","default","Cubism2Model","import","cubism5model","release","gl","changeModelWithJSON","init","AppDelegate","Cubism5Model","destroy","subdelegates","at","changeModel","initialize","run","err","loadModel","textures","loadRandTexture","successMessage","failMessage","noTextureAvailable","loadNextModel","messages","fa_comment","fa_info_circle","ChatUI","endpoint","tipsEl","container","listEl","inputEl","sendBtn","id","role","content","visible","setTipsElement","el","Object","assign","style","position","bottom","right","width","background","boxShadow","borderRadius","overflow","display","flexDirection","gap","zIndex","title","padding","fontWeight","borderBottom","textContent","list","maxHeight","overflowY","borderTop","input","placeholder","flex","border","fontSize","addEventListener","e","key","handleSend","btn","color","cursor","whiteSpace","hide","body","refresh","m","bubble","isUser","alignSelf","maxWidth","wordBreak","scrollTop","scrollHeight","show","toggle","addMessage","push","Date","now","setLoading","disabled","_b","_c","value","trim","chatApiKey","undefined","embedApiKey","r","method","headers","JSON","stringify","history","keys","ok","Error","status","data","__chatUI","CHAT_KEY_STORAGE","EMBED_KEY_STORAGE","SettingsUI","chatInput","embedInput","wrap","form","chatLabel","embedLabel","actions","paddingTop","saveBtn","save","clearBtn","clear","load","__settingsUI","ToolsManager","tools","chat","icon","callback","ensureChatUI","chatEndpoint","settings","hitokoto","async","from","creator","asteroids","window","Asteroids","ASTEROIDSPLAYERS","script","changeSuccess","changeFail","photo","canvas","imageUrl","toDataURL","link","href","download","click","removeChild","open","quit","goodbye","waifu","waifuToggle","registerTools","toolName","element","insertAdjacentElement","loadWidget","insertAdjacentHTML","waifuPath","userActionTimer","userAction","messageArray","lastHoverElement","seasons","forEach","date","after","split","before","Number","getMonth","getDate","getFullYear","setInterval","clearInterval","event","selector","mouseover","target","closest","innerText","hoverBody","tapBody","devtools","copy","hidden","visibilitychange","registerEventListener","time","welcomeTemplate","referrerTemplate","location","pathname","hour","getHours","referrer","URL","hostname","welcomeMessage","welcome","drag","winWidth","innerWidth","winHeight","innerHeight","imgWidth","offsetWidth","imgHeight","offsetHeight","button","preventDefault","_offsetX","offsetX","_offsetY","offsetY","onmousemove","_x","clientX","_y","clientY","_left","_top","top","left","onmouseup","onresize","registerDrag","initWidget","logLevel","getAttribute","removeAttribute","setAttribute"],"mappings":"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"}